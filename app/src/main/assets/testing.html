<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>测试</title>
        <!-- Bootstrap CSS -->
        <script src="dist/js/bootstrap.bundle.min.js"></script>
        <link href="dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/lhelp.css" rel="stylesheet">
        <link href="css/universal.css" rel="stylesheet">
    </head>
   
    <body>
         <!--导航栏-->
         <div id="container">
            <header>
                <div class="navbar-dark pt-4 fixed-top" style="background-color: royalblue;">
                    <div class="container-fluid">
                        <div class="row mt-3  justify-content-center">
                            <div class="col">
                                        <p class="text-center text-light" style="font-size: 20px;">句子翻译</p>
                            </div>
                        </div>
                    </div>
                </div>          
            </header>
            <div class="main">
                <div class="container-fluid mt-3 pt-5">
                    <div class="p-4"></div>
                    <div class="row">
                        <div class="col">
                            <div class="bd-example">
                                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                  <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="false">Home</button>
                                  </li>
                                  <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="true">Profile</button>
                                  </li>
                                  <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Contact</button>
                                  </li>
                                </ul>
                                <div class="tab-content" id="pills-tabContent">
                                  <div class="tab-pane fade" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                                    <p>Placeholder content for the tab panel. This one relates to the home tab. Takes you miles high, so high,
                                      'cause she’s got that one international smile. There's a stranger in my bed, there's a pounding in my head.
                                      Oh, no. In another life I would make you stay. ‘Cause I, I’m capable of anything. Suiting up for my crowning
                                      battle. Used to steal your parents' liquor and climb to the roof. Tone, tan fit and ready, turn it up cause
                                      its gettin' heavy. Her love is like a drug. I guess that I forgot I had a choice.</p>
                                  </div>
                                  <div class="tab-pane fade active show" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                                    <p>Placeholder content for the tab panel. This one relates to the profile tab. You got the finest architecture.
                                      Passport stamps, she's cosmopolitan. Fine, fresh, fierce, we got it on lock. Never planned that one day I'd be
                                      losing you. She eats your heart out. Your kiss is cosmic, every move is magic. I mean the ones, I mean like
                                      she's the one. Greetings loved ones let's take a journey. Just own the night like the 4th of July! But you'd
                                      rather get wasted.</p>
                                  </div>
                                  <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                                    <p>Placeholder content for the tab panel. This one relates to the contact tab. Her love is like a drug. All my
                                      girls vintage Chanel baby. Got a motel and built a fort out of sheets. 'Cause she's the muse and the artist.
                                      (This is how we do) So you wanna play with magic. So just be sure before you give it all to me. I'm walking,
                                      I'm walking on air (tonight). Skip the talk, heard it all, time to walk the walk. Catch her if you can.
                                      Stinging like a bee I earned my stripes.</p>
                                  </div>
                                </div>
                              </div>
                        </div>
                    </div>
                    <div class="card m-2 border-0">
                        <div class="card-header ">
                            <div class="row align-items-center">
                                <div class="col-3">
                                    <figure class="text-center"><p class="card_primary" style="font-Size:46px;" id="bighz">${hz}</p></figure>
                                </div>
                                <div class="col-9">
                                    <p class="m-1">笔画：<span class="card_text">${bh}</span></p>
                                    <p class="m-1">部首：<span class="card_text">${ps}</span></p>
                                    <p class="m-1">普通话：<span class="card_text">${cmnp}</span></p>
                                    <p class="m-1">异体字：<span class="card_text">${vas}</span></p>
                                </div>
                            </div>
                        </div>
    
                        <div class="card-body p-0" class="card_text">
                                    <div class="row g-0">
                                        <div class="col-4">
                                            <div class="list-group p-0" id="areas">
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0 active" onclick="changeSoundVisible(0)">粤东</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(1)">粤西</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(2)">粤珠</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(3)">粤北</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(4)">广西</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(5)">海南</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(6)">川湘</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(7)">江西</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(8)">福建</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(9)">台湾</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(10)">海外</a>
                                                <a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible(11)">其他</a>
                                            </div>
                                        </div>
                                        <div class="col-8">
                                            <div class="list-group scrollsby-list p-2" id="pagers">
                                            </div>
                                        </div>
                                    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var left_lis=allHakkaspagers()
            console.log(left_lis)
            //var leftall=document.getElementById('leftall')
            //leftall.innerHTML=left_lis
            

            //changeSoundVisible(0)

            function $et(Nid){
                return document.getElementById(Nid)
            }
            function $tag(pNid,Nid){
                return pNid.getElementsByTagName(Nid)
            }

            //封装AJax异步请求函数
var timer;
function sendAjax(url,timeout,success_callback,failed_callback){
    var xhr=new XMLHttpRequest()

    var timedout=false;
    timer=setTimeout(()=>{
        console.log('请求终止！')
        xhr.abort();
        failed_callback();
        timedout=true;
       // timeout_callback();
    },timeout);

    xhr.onreadystatechange=()=>{
        if(xhr.readyState!=4) return;
        if(timedout) return;
        clearTimeout(timer)
        if(xhr.readyState==4&&xhr.status==200){
            if(xhr.responseText.startsWith('<')){
                console.log(xhr.responseText)
                console.log('验证返回文本失败，已回调失败处理函数！')
                xhr.abort()
                failed_callback()
                return;
            }
            else success_callback(xhr.responseText);

        }else{
            failed_callback();
        }
        
    };
    
    xhr.open('GET',url);
    xhr.send();
}

            //生成各地客家话读音分布布局代码
function allHakkaspagers(){
    var alis=generateTab();
    var pagerTab=`<div class="row align-items-start p-0">
                    <div class="col-4">
                        <div class="list-group p-0" id="areas">${alis}</div>
                    </div>
                    <div class="col-8">
                        <div class="list-group scrollsby-list" id="pagers">
                        </div>
                        <ul class="list-group visually-hidden scrollsby-list" id="source" visinot="visi">
                            <li class="list-group-item normalText border-0 pe-s ps-0 mt-1"><a href="hkapp://detail_/" class="aslin">嘉应客语</a>：1926年客法字典</li>
                            <li class="list-group-item normalText border-0 pe-s ps-0 mt-1"><a href="hkapp://detail_/" class="aslin">梅县客语</a>：汉典</li>
                            <li class="list-group-item normalText border-0 pe-s ps-0 mt-1"><a href="hkapp://detail_/" class="aslin">揭西客语</a>：汉典</li>
                        </ul>
                    </div>
                 </div>`
    return pagerTab;
}

function generateTab(){
    var alis=''
    var hanzs=['粤东','粤西','粤珠','粤北','广西','海南','川湘','江西','福建','台湾','海外','其他']
    //var hanzs_code=['jetd','jets','jetz','jetb','guongs','hoin','gongs','fukg','hoing','kit']
    for(var s=0;s<hanzs.length;s++){
        //onclick="changeSoundVisible()"
        if(s==0) var alist='<a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0 active" onclick="changeSoundVisible('+s+')">'+hanzs[s]+'</a>'
        else var alist='<a class="list-group-item border-start-0 border-top-0 border-bottom-0 rounded-0 text-center m-0" onclick="changeSoundVisible('+s+')">'+hanzs[s]+'</a>'
        alis+=alist;
    }
    return alis;
}



//各地客家话读音页面
//sound为json模型，包含detailHakka和sou
function returnPager(sound){
    console.log(sound)
    var names=sound.hknames;
    var pins=sound.hkpins
    //console.log(pins)
    var contents='';

    if(sound!=''){
        for(var f=0;f<names.length;f++){
            //添加origin-datas标签以保持转换前数据，方便请求服务器
            contents+=`
                    <li class="list-group-item normalText border-0 p-0 m-0">
                        <h6>
                            ${names[f]}
                        </h6>
                        <p class="aslin p-0 m-0" style="letter-spacing:0.6px;">${pins[f]}<p/>
                    </li>`
        }
    }else{
        for(var f=0;f<10;f++){
            //添加origin-datas标签以保持转换前数据，方便请求服务器
            contents+='<li class="list-group-item border-0 normalText">第'+f+'客家读音:&nbsp;<a class="aslin">加载失败<a/></li>'
        }
    }

    return contents;
}

function CheckSource(){
    var pager_root=$et("pagers")
    var source_root=$et('source');

    var visinot=source_root.getAttribute('visinot')
    if(visinot=='visi'){
        pager_root.classList.remove('visually-hidden')
        source_root.classList.add('visually-hidden')
        source_root.setAttribute('visinot','not')
    }else{
        pager_root.classList.add('visually-hidden')
        source_root.classList.remove('visually-hidden')
        source_root.setAttribute('visinot','visi')
    }
}


//读音显示格式切换请求API，通过请求服务器以获得转换后的数据，并重新加载
function changeSoundVisible(area_codes){
    var pager_root=$et('pagers')
    var hz=$et('bighz').innerText;
    var hanzs_code=['jetd','jets','jetz','jetb','gongs','hoin','gongx','fukg','hoing','kit']
    var type=2
    var toney=1
    var area_code=''
    switch(area_codes){
        case 0:
            area_code=hanzs_code[area_codes];
            break;
        default:
            area_code='';
            break;

    }

    var sounds_root=$et('areas')
    var allsounds=$tag(sounds_root,'a')
    //遍历所有<li>标签以获得所有的读音数据
    for(var t=0;t<allsounds.length;t++){
        allsounds[t].classList.remove('active')
    }
    allsounds[area_codes].classList.add('active')

    pager_root.innerHTML='<li class="list-group border-0 normalText"><p class="p-3">数据加载中...<p></li>'


    //请求API，通过请求参数来请求不同的显示数据
    var api_request='http://dict.hazukieq.top/lindex/getpins?value=放&hkarea='+area_code+'&type='+type+'&toney='+toney;

    if(area_code=='jetd'){
        sendAjax(api_request,2000,
            (text)=>{
                var jsons=JSON.parse(text)
                //console.log(jsons.hkpins)
                pager_root.innerHTML=returnPager(jsons)
            },
            ()=>{
                pager_root.innerHTML='<li class="list-group normalText border-0 p-0 m-0"><p class="p-3">加载失败<br/><a class="btn btn-primary mt-2" onclick="changeSoundVisible('+area_codes+')">请重试</a><p></li>'
            })
    }else{
        pager_root.innerHTML='<li class="list-group-item normalText border-0 p-0"><h6 class="p-3">内容为空...<br/>管理员太懒了orz<h5/></li>'
    }
    
}

        </script>
        </body>
</html>